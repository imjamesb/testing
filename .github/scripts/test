#!/usr/bin/env -S zx
$.verbose = false;

let text = "";

process.stdin.on("data", (data) => {
	text += data.toString("utf-8");
});
await new Promise((resolve) => process.stdin.on("end", resolve));

const data = JSON.parse(text);
// prettier-ignore
const repo = (await $`git remote get-url origin`).stdout.substring(19);

/** @type {string[]} */
const messages = data.commits.map((commit) => commit.message);

for (const message of messages) {
	console.log([
		...message.matchAll(
			/\#(major|minor|patch|premajor|preminor|prepatch|prerelease|(version)\=([\d\.\-\w]+))/g,
		),
	]);
}

// prettier-ignore
JSON.stringify(data, null, 2).split("\n").forEach(line => console.log(line));
console.log("::set-output name=step::patch");
